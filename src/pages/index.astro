---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProjectCard from '../components/ProjectCard.astro';
import PostEntry from '../components/PostEntry.astro';
import { getCollection } from 'astro:content';
import { CDN_URL } from '../lib/constant';

const allPosts = await getCollection('posts');

// Sort them by date or ID
const sortedPosts = allPosts.sort((a, b) => 
    b.data.id.localeCompare(a.data.id)
);
const firstId = sortedPosts[sortedPosts.length - 1].data.id; // The earliest post ID
const lastId = sortedPosts[0].data.id;                      // The latest post ID
---

<Layout pageId='index'>
	<div id="canvas-container"></div>
	<main class="relative z-10 grid grid-cols-12 gap-6 px-6 py-12 min-h-screen bg-transparent text-brand-black font-sans">

		<div class="hero-section col-span-12 min-h-screen flex flex-col">				
			<Header transition:persist/>

			<div class="flex-grow flex items-center w-full">
				<div class="w-full">
					<ProjectCard />
				</div>
			</div>
		</div>
		
		<div class="feed-container col-span-12 border-t-2 border-brand-black mt-24 mb-8 pt-2">
			<span 
				class="feed-id-display font-mono text-[10px] uppercase tracking-widest"
				data-final-id={firstId === lastId ? firstId : `${firstId}â€”${lastId}`}
			>
				Selected Feed // ---
			</span>
		</div>
		<section class="col-span-12">
			{sortedPosts.map(post => (
				<PostEntry 
					id={post.data.id}
					title={post.data.title}
					subtitle={post.data.subtitle}
					coverImage={post.data.coverImage}
					date={post.data.date} 
					url={`/posts/${post.data.permalink}`} 
				/>
			))}
		</section>
		<Footer/>

	</main>
	<style>
		#canvas-container {
			position: absolute; 
			top: 0;
			left: 0;
			width: 100%;    /* Takes full width of the viewport */
			height: 100vh;  /* Takes full height of the viewport */
			z-index: 0;
		}
		.reveal-item {
			will-change: transform; /* Optimization for smoother movement */
		}

		/* Ensure the image container is actually hiding the scaled-up image */
		.post-entry .overflow-hidden {
			position: relative;
		}
	</style>
</Layout>
