---
import { Image, getImage } from 'astro:assets';
import { cn } from '../lib/utils';

interface Props {
  src: ImageMetadata;
  alt: string;
  width?: number;
  quality?: number;
  class?: string;
  imageClass?: string;
  loading?: "lazy" | "eager";
  transitionName?: string;
}

const { 
  src, 
  alt, 
  width = 1200, 
  quality = 90, 
  class: className, 
  imageClass, 
  loading = "lazy",
  transitionName
} = Astro.props;

const highRes = await getImage({ 
  src: src, 
  width: src.width, 
  format: 'webp',
  quality: quality 
});

const decoding = loading === "eager" ? "sync" : "async";
---

<a 
  href={highRes.src} 
  data-pswp-width={src.width} 
  data-pswp-height={src.height} 
  target="_blank"
  class:list={["block cursor-zoom-in", className]}
>
  <Image 
    src={src}
    alt={alt} 
    transition:name={transitionName}
    width={Math.min(width, src.width)}
    loading={loading}
    decoding={decoding}
    format="webp"
    class={cn("w-full h-auto", imageClass)} 
  />
</a>